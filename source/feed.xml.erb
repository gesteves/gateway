<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <% updated = data.articles.reject(&:draft).map { |e| DateTime.parse(e.updated_at) }.max %>
  <id><%= atom_tag(full_url("/index.html"), data.articles.reject(&:draft).map { |e| DateTime.parse(e.published_at) }.min) %></id>
  <title type="text"><%= data.home.title %></title>
  <updated><%= updated.rfc3339 %></updated>
  <link rel="alternate" type="text/html" href="<%= full_url("/index.html") %>"/>
  <link rel="self" type="application/atom+xml" href="<%= full_url("/feed.xml") %>"/>
  <rights>© <%= data.articles.reject(&:draft).map { |a| DateTime.parse(a.published_at) }.min.strftime('%Y') %>–<%= Time.now.strftime('%Y') %> <%= data.author.name %></rights>
  <% data.articles.reject(&:draft).slice(0, 25).each do |article| %>
    <entry>
      <% updated = DateTime.parse(article.updated_at) %>
      <id><%= atom_tag(full_url(article.path), DateTime.parse(article.published_at)) %></id>
      <title><%= escape_html article.title %></title>
      <link rel="alternate" type="text/html" href="<%= full_url(article.path) %>"/>
      <published><%= DateTime.parse(article.published_at).rfc3339 %></published>
      <updated><%= updated.rfc3339 %></updated>
      <author>
        <name><%= article.author.name %></name>
      </author>
      <% if article.summary.present? %>
        <summary><%= article.summary %></summary>
      <% end %>
      <content type="html">
        <%= escape_html set_alt_text(add_figure_elements(markdown_to_html(article.body))) %>
      </content>
      <% if article.contentfulMetadata.tags.present? %>
        <% article.contentfulMetadata.tags.sort { |a, b| a.name <=> b.name }.each do |tag| %>
          <category term="<%= tag.name %>" />
        <% end %>
      <% end %>
    </entry>
  <% end %>
</feed>
